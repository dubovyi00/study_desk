(this.webpackJsonpStudyDesk=this.webpackJsonpStudyDesk||[]).push([[0],{211:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=211},376:function(e,t){},377:function(e,t){},378:function(e,t){},379:function(e,t){},380:function(e,t){},381:function(e,t){},382:function(e,t){},469:function(e,t,n){"use strict";n.r(t);var r=n(0),s=n.n(r),o=n(73),a=n.n(o),c=n(5),i=n.n(c),l=n(13),u=n(8),d=n(9),p=n(10),f=n(11),h=n(20),x=n(18),b=n(2),j=n(127),m=n(174),k=(n(357),n(3));function O(e){var t=e.element,n=e.history,r=e.match,o=e.routeMap,a=e.closeModal,c=e.appFunctions;e.redirect;return s.a.cloneElement(t,{navigation:{navigate:function(e,t){var s=o[e].path;if(t&&Object.keys(t).length>0&&Object.keys(t).forEach((function(e){var n=RegExp(":".concat(e,"\\??"));s=s.replace(n,escape(t[e]))})),s=s.replace(/\/:(.*?)(?=\/|$)/g,""),o[e].modal){var a=/\/$/.test(r.url)?"":"/";s=(s=r.url+a+s).replace(/\*\/?/g,""),n.push(s)}else n.push(s)},getParam:function(e,t){return r.params[e]||t},goBack:function(){n.goBack()}},appFunctions:c,closeModal:a})}var g=function(e){var t=e.routeMap,n=e.appFunctions;return Object.keys(t).map((function(e){var r=t[e],s=r.component;return r.modal?Object(k.jsx)(m.ModalRoute,{path:r.path,component:function(e){return Object(k.jsx)(O,Object(b.a)(Object(b.a)({element:Object(k.jsx)(s,{})},e),{},{routeMap:t,appFunctions:n}))}},r.path):Object(k.jsx)(j.a,{path:r.path,exact:r.exact,render:function(e){return Object(k.jsx)(O,Object(b.a)(Object(b.a)({element:Object(k.jsx)(s,{})},e),{},{routeMap:t,appFunctions:n}))}},r.path)}))},y=n(68),v=n(82),S=n(254),T=n(85),_=n(192),I=n(193),w=n(190),D=y.a.get("window"),C=D.width,E=(D.height,18),A="https://sd.randgor.ru/app/teacher_placeholder.png",R=Object(b.a)(Object(b.a)({},w.a),{},{dark:!0,colors:Object(b.a)(Object(b.a)({},w.a.colors),{},{accent:"#C89D66",text2:"#999999",background:"#222226",card:"#333336"})}),N="1px 1px 1px grey",M="#000",P=R.colors.background,U=(R.colors.accent,R.colors.text2,"https://sd.randgor.ru/api"),F=n(39);function B(e){alert(e)}var L=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(u.a)(this,n);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).state={email:"",password:"",buttonActive:!0},e.onPressLogin=function(){var t=Object(l.a)(i.a.mark((function t(n){var r,s,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.buttonActive){t.next=2;break}return t.abrupt("return");case 2:if(0!=n.email.length){t.next=5;break}return B("\u041f\u0443\u0441\u0442\u043e\u0439 email"),t.abrupt("return");case 5:if(0!=n.password.length){t.next=8;break}return B("\u041f\u0443\u0441\u0442\u043e\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"),t.abrupt("return");case 8:if(0!=/\S+@\S+.\S+/.test(n.email)){t.next=11;break}return B("\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 email"),t.abrupt("return");case 11:return e._isMounted&&e.setState({buttonActive:!1}),r={username:n.email,password:n.password},t.prev=13,t.next=16,fetch(U+"/login",{mode:"cors",method:"POST",body:JSON.stringify({data:r}),headers:{"Content-Type":"application/json"}});case 16:if(s=t.sent,console.log(s.ok),!s.ok){t.next=37;break}if(t.t0=e._isMounted,!t.t0){t.next=24;break}return t.next=23,s.json();case 23:t.t0=t.sent;case 24:if(o=t.t0,t.prev=25,t.t1=e._isMounted,!t.t1){t.next=30;break}return t.next=30,F.a.setItem("userProfile",JSON.stringify({access_token:o.access_token,refresh_token:o.refresh_token,is_student:o.is_student}));case 30:e.props.appFunctions.redirect({accessToken:o.access_token,refreshToken:o.refresh_token,isStudent:o.is_student}),t.next=35;break;case 33:t.prev=33,t.t2=t.catch(25);case 35:t.next=41;break;case 37:return t.next=39,s.json();case 39:B(t.sent.message);case 41:t.next=47;break;case 43:t.prev=43,t.t3=t.catch(13),console.log("catch: ",t.t3.message),B(t.t3.message);case 47:e._isMounted&&e.setState({buttonActive:!0});case 48:case"end":return t.stop()}}),t,null,[[13,43],[25,33]])})));return function(e){return t.apply(this,arguments)}}(),e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this,t=this.props;t.navigation,t.route;return Object(k.jsxs)(h.a,{style:W.container,children:[Object(k.jsx)(T.a,{style:W.img,source:{uri:"https://sd.randgor.ru/app/logo_round.png"}}),Object(k.jsx)(v.a,{style:W.header,children:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f"}),Object(k.jsx)(_.a,{type:"email",name:"email",style:W.input,onChangeText:function(t){return e.setState({email:t})},value:this.state.email,placeholder:"E-mail",placeholderTextColor:R.colors.text2}),Object(k.jsx)(_.a,{type:"password",name:"password",style:W.input,onChangeText:function(t){return e.setState({password:t})},value:this.state.password,placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",placeholderTextColor:R.colors.text2,onSubmitEditing:function(){return e.onPressLogin(e.state)},secureTextEntry:!0}),Object(k.jsx)(h.a,{style:W.buttoncase,children:Object(k.jsx)(I.a,{color:R.colors.accent,disabled:!this.state.buttonActive,title:this.state.buttonActive?"\u0412\u043e\u0439\u0442\u0438":"\u0412\u0445\u043e\u0434...",onPress:function(){return e.onPressLogin(e.state)}})})]})}}]),n}(s.a.Component),W=x.a.create({img:{width:100,height:100,margin:16},container:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:R.colors.background},welcome:{fontSize:20,textAlign:"center",margin:10},input:{height:40,width:270,marginBottom:16,paddingLeft:16,borderRadius:3,backgroundColor:R.colors.card,color:R.colors.text},buttoncase:{width:100,marginBottom:150},header:{fontSize:20,marginBottom:24,color:R.colors.text}}),z=L,Y=n(22),J=n(57),H=n(76),G=(n(373),n(208)),q=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props.style,t=[K.container,e];return Object(k.jsxs)(h.a,{style:t,children:[Object(k.jsx)(G.a,{size:70,color:R.colors.accent}),Object(k.jsx)(v.a,{style:K.welcome,children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."})]})}}]),n}(s.a.Component),K=x.a.create({container:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:R.colors.background},welcome:{fontSize:20,textAlign:"center",margin:10,color:R.colors.text2}}),V=q,Q=null,Z=function(){function e(){return Object(u.a)(this,e),Q||(Q=this,this.ws=new WebSocket("wss://sd.randgor.ru/socket:443")),Q}return Object(d.a)(e,[{key:"nullify",value:function(){Q=null}}]),e}(),$=(n(374),n(476)),X=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return Object(k.jsx)($.a,Object(b.a)(Object(b.a)({},this.props),{},{style:[{margin:15,padding:15,marginBottom:0,backgroundColor:R.colors.card},this.props.style],children:this.props.children}))}}]),n}(s.a.Component),ee=n(477);function te(e){return Object(k.jsx)(H.a,Object(b.a)(Object(b.a)({},e),{},{wrapperStyle:{right:{backgroundColor:R.colors.accent}}}))}function ne(e){return Object(k.jsx)(H.e,Object(b.a)(Object(b.a)({},e),{},{containerStyle:{justifyContent:"center",alignItems:"center",alignSelf:"center",marginRight:15},children:Object(k.jsx)(ee.a,{name:"send",size:20,color:R.colors.accent})}))}function re(e){return Object(k.jsx)(H.d,Object(b.a)(Object(b.a)({},e),{},{textInputProps:Object(b.a)(Object(b.a)({},e.textInputProps),{},{blurOnSubmit:!0,onSubmitEditing:"web"===J.a.OS?function(){e.text&&e.onSend&&e.onSend({text:e.text.trim()},!0)}:void 0}),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",onSubmitEditing:function(){console.log("onSubmitEditing")},textInputStyle:{color:R.colors.text},containerStyle:{backgroundColor:R.colors.background}}))}function se(e){var t=Object(r.useState)([]),n=Object(Y.a)(t,2),s=n[0],o=n[1],a=Object(r.useState)({accessToken:null,refreshToken:null}),c=Object(Y.a)(a,2),u=c[0],d=c[1],p=Object(r.useState)({roomId:-1,myId:-1}),f=Object(Y.a)(p,2),x=f[0],b=f[1];"android"==J.a.OS?-1==x.roomId&&b({roomId:e.route.params.room_id,myId:e.route.params.my_id}):-1==x.roomId&&b({roomId:e.navigation.getParam("room_id",-1),myId:e.navigation.getParam("my_id",-1)});var j=function(){var e=Object(l.a)(i.a.mark((function e(){var t,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=JSON,e.next=4,F.a.getItem("userProfile");case 4:e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1),n=t.access_token,r=t.refresh_token,t.is_student,d({accessToken:n,refreshToken:r}),e.next=14;break;case 12:e.prev=12,e.t2=e.catch(0);case 14:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){j()}),[]),Object(r.useEffect)(Object(l.a)(i.a.mark((function t(){var n,r,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=u.accessToken){t.next=2;break}return t.abrupt("return");case 2:return n={access_token_cookie:u.accessToken,refresh_token_cookie:u.accessToken,roomId:x.roomId},t.prev=3,t.next=6,fetch(U+"/chat/room",{mode:"cors",method:"PUT",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}});case 6:r=t.sent,t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(3),console.log("no connection for room in useEffect",t.t0),t.abrupt("return");case 13:if(200!=r.status){t.next=26;break}return t.prev=14,t.next=17,r.json();case 17:(s=t.sent)[0]?o(s[0].messages):console.log("empty messages array in room"),t.next=24;break;case 21:t.prev=21,t.t1=t.catch(14),console.log("chat error",t.t1);case 24:t.next=27;break;case 26:400==r.status?e.appFunctions.tryRefreshToken(j):console.error("response status in room",r.status);case 27:case"end":return t.stop()}}),t,null,[[3,9],[14,21]])}))),[u]),Object(r.useEffect)((function(){var e=(new Z).ws;null!=u.accessToken&&(e.onopen=function(){console.log("socket is open",u.accessToken?"tokens exists":"tokens not exist"),e.send(JSON.stringify({ms_type:1,access_token_cookie:u.accessToken,refresh_token_cookie:u.refreshToken,myId:x.myId,roomId:x.roomId}))})}),[u]),Object(r.useEffect)((function(){var e=new Z,t=e.ws;return t.onmessage=function(e){var t=JSON.parse(e.data);o((function(e){return H.c.prepend(e,t)}))},t.onerror=function(e){console.log("socket eroor",e.message)},t.onclose=function(t){e.nullify(),console.log("socket close",t.code,t.reason)},function(){t.close(4e3,"left from chat")}}),[]);var m=Object(r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=new Z,n=t.ws,r={ms_type:2,messages:e[0]};1==n.readyState?n.send(JSON.stringify(r)):console.log("bad state websocket")}),[]);return Object(k.jsx)(h.a,{style:oe.mainBox,contentContainerStyle:{flexDirection:"row",justifyContent:"center"},children:Object(k.jsx)(X,{style:oe.container,children:Object(k.jsx)(H.c,{messages:s,onSend:function(e){return m(e)},locale:"ru",renderBubble:te,renderSend:ne,renderInputToolbar:re,inverted:!1,user:{_id:x.myId}})})})}var oe=x.a.create({mainBox:{flex:1,backgroundColor:R.colors.background,flexDirection:"row",justifyContent:"center"},container:Object(b.a)({flex:1,maxWidth:700},J.a.select({android:{margin:0,padding:0,backgroundColor:R.colors.background}}))}),ae=n(204),ce=n(67),ie=n(96),le=n(478),ue=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this,e)).ChooseFile=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(ie.a)({multiple:!1,copyToCacheDirectory:!0,type:"*/*"}).then((function(e){if("success"==e.type){e.type=e.name.indexOf(".")<0?"":/\.([0-9a-z]+)(?:[\?#]|$)/.exec(e.name)[0].toLocaleLowerCase(),e.extension=e.type.substring(1);var t=!1;if(-1!="pdf;".split(";").indexOf(e.extension)&&(t=!0),-1!="xlsx;xlsm;xlsb;xlam;xltx;xltm;xls;xlt;xla;xlm;xlw;odc;ods;prn;csv;dsn;mdb;mde;accdb;accde;dbc;iqy;dqy;rqy;oqy;cub;atom;atomsvc;dbf;xll;xlb;slk;dif;xlk;bak;pptx;ppt;pptm;ppsx;pps;ppsm;potx;pot;potm;odp;thmx;docx;docm;doc;ppam;ppa;docx;docm;dotx;dotm;doc;odt;docx;docm;doc;dotx;dotm;dotx;dotm;rtf;odt;doc;wpd;doc".split(";").indexOf(e.extension)&&(t=!0),-1!="png;jpg;jpeg".split(";").indexOf(e.extension)&&(t=!0),-1!="txt;c;h;cpp;cs;java;json;js;php;py;asm;sql;html;xml;yaml;md".split(";").indexOf(e.extension)&&(t=!0),t)if("web"==J.a.OS)r.setState({isConverted:!1,resultConverted:{}}),r.setState({files:r.state.files.concat(e)});else{var n=e.uri;le.a(n,{encoding:"base64"}).then((function(t){var n="data:application/vnd.custom-type;base64,"+t;e.uri=n,r.setState({isConverted:!1,resultConverted:{}}),r.setState({files:r.state.files.concat(e)})})).catch((function(e){return console.log("wtf error")}))}else alert("\u041d\u0435\u0432\u0435\u0440\u043d\u043e\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430")}})).catch((function(e){console.error("\u041e\u0448\u0438\u0431\u043a\u0430",e)}));case 1:case"end":return e.stop()}}),e)}))),r.Convert=Object(l.a)(i.a.mark((function e(){var t,n,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=r.state.files.length){e.next=2;break}return e.abrupt("return");case 2:return r.setState({isLoading:!0}),r.setState({isConverted:!1}),r.setState({resultConverted:{}}),t=JSON.stringify({data:r.state.files}),e.prev=6,e.next=9,fetch(U+"/upload",{mode:"cors",method:"POST",headers:{"Content-Type":"application/vnd.custom-type"},body:t});case 9:if(n=e.sent,console.log("response",n),200!=n.status){e.next=19;break}return e.next=14,n.json();case 14:s=e.sent,r.setState({isConverted:!0}),r.setState({resultConverted:s.data}),e.next=28;break;case 19:if(401!=n.status){e.next=23;break}r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=28;break;case 23:return e.next=25,n.json();case 25:o=e.sent,console.log(o.message),alert(o.message);case 28:r.setState({isLoading:!1}),e.next=38;break;case 31:e.prev=31,e.t0=e.catch(6),console.log("\u041e\u0448\u0438\u0431\u043a\u0430",e.t0),alert("\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435!"),r.setState({isConverted:!1}),r.setState({resultConverted:{}}),r.setState({isLoading:!1});case 38:case"end":return e.stop()}}),e,null,[[6,31]])}))),r.DownloadFile=Object(l.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.state.resultConverted,n=t.path,console.log(t),e.next=5,ae.a.openURL(n);case 5:case"end":return e.stop()}}),e)}))),r.ItemMoveUp=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t<=0)){e.next=2;break}return e.abrupt("return");case 2:n=r.state.files,s=n[t],n[t]=n[t-1],n[t-1]=s,r.setState({files:n}),r.setState({isConverted:!1,resultConverted:{}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.ItemMoveDown=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>=r.state.files.length-1)){e.next=2;break}return e.abrupt("return");case 2:n=r.state.files,s=n[t],n[t]=n[t+1],n[t+1]=s,r.setState({files:n}),r.setState({isConverted:!1,resultConverted:{}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.ItemDelete=function(){var e=Object(l.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.state.files.filter((function(e,n){return n!=t})),r.setState({isConverted:!1,resultConverted:{}}),r.setState({files:n});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(new Date).setHours(0,0,0,0),r.state={files:[],isLoading:!1,isConverted:!1,resultConverted:{}},r}return Object(d.a)(n,[{key:"bytesToSize",value:function(e){if(0==e)return"0 \u0411";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+" "+["\u0411","\u041a\u0411","\u041c\u0411","\u0413\u0411","\u0422\u0411"][t]}},{key:"render",value:function(){var e=this,t=(this.props.navigation,this.state.resultConverted),n=Object(k.jsx)(X,{children:Object(k.jsxs)(h.a,{style:de.inputBox,children:[Object(k.jsx)(v.a,{style:de.headerText,children:"\u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0432 PDF"}),Object(k.jsx)(v.a,{style:de.disclaimer,children:"\u041c\u044b \u043d\u0435 \u043d\u0435\u0441\u0451\u043c \u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u0437\u0430 \u043a\u043e\u043d\u0444\u0438\u0434\u0435\u043d\u0446\u0438\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432."}),Object(k.jsx)(h.a,{style:de.selectFileBox,children:Object(k.jsx)(I.a,{color:R.colors.accent,title:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0444\u0430\u0439\u043b",disabled:!!this.state.isLoading,onPress:function(){return e.ChooseFile()}})})]})}),r=this.state.files.map((function(t,n){return Object(k.jsxs)(h.a,{style:de.listview,children:[Object(k.jsx)(h.a,{style:{flex:1},children:Object(k.jsxs)(v.a,{style:de.listItemHeader,children:[n+1,". ",t.name," (",e.bytesToSize(t.size),")"]})}),Object(k.jsx)(h.a,{style:de.listItemButton,children:Object(k.jsx)(I.a,{disabled:!!e.state.isLoading,title:"\u25b2",onPress:function(){return e.ItemMoveUp(n)}})}),Object(k.jsx)(h.a,{style:de.listItemButton,children:Object(k.jsx)(I.a,{disabled:!!e.state.isLoading,title:"\u25bc",onPress:function(){return e.ItemMoveDown(n)}})}),Object(k.jsx)(h.a,{style:de.listItemButton,children:Object(k.jsx)(I.a,{disabled:!!e.state.isLoading,title:"\u26cc",onPress:function(){return e.ItemDelete(n)},color:"#dc3545"})})]},n)})),s=0==this.state.files.length?Object(k.jsx)(h.a,{}):Object(k.jsx)(X,{children:Object(k.jsxs)(h.a,{style:de.listviewBox,children:[Object(k.jsx)(v.a,{style:de.headerText,children:"\u0421\u043f\u0438\u0441\u043e\u043a \u0444\u0430\u0439\u043b\u043e\u0432"}),r,Object(k.jsx)(h.a,{style:de.convertFileBox,children:Object(k.jsx)(I.a,{color:"#c93757",disabled:!!this.state.isLoading,title:this.state.isLoading?"\u041a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u0443\u0435\u043c...":"\u041a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c",onPress:function(){return e.Convert()}})})]})}),o=this.state.isConverted?Object(k.jsxs)(X,{children:[Object(k.jsx)(v.a,{style:de.headerText,children:"\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442"}),Object(k.jsx)(h.a,{style:de.listview,children:Object(k.jsx)(h.a,{style:{flex:1},children:Object(k.jsxs)(v.a,{style:de.listItemHeader,children:[t.name," (",this.bytesToSize(t.size),")"]})})}),Object(k.jsx)(h.a,{style:de.downloadFileBox,children:Object(k.jsx)(I.a,{color:R.colors.accent,title:"\u0421\u043a\u0430\u0447\u0430\u0442\u044c",onPress:function(){return e.DownloadFile(t.path)}})})]}):Object(k.jsx)(h.a,{});return Object(k.jsx)(ce.a,{style:de.mainScroll,contentContainerStyle:{flexDirection:"row",justifyContent:"center"},children:Object(k.jsxs)(h.a,{style:de.container,children:[n,s,o]})})}}]),n}(s.a.Component),de=x.a.create({mainScroll:{backgroundColor:R.colors.background},container:{paddingBottom:16,maxWidth:700,flex:1},inputBox:{flexDirection:"column",alignItems:"center"},headerText:{fontSize:27,color:R.colors.text,textAlign:"center",fontWeight:"bold",marginBottom:12},disclaimer:{fontSize:11,textAlign:"center",marginBottom:10,color:R.colors.text2},selectFileBox:{alignItems:"center",flexDirection:"row"},listviewBox:{flexDirection:"column"},listview:{backgroundColor:R.colors.background,borderRadius:4,alignItems:"center",flexDirection:"row",margin:4,flex:1},listItemHeader:Object(b.a)({color:R.colors.text2,margin:10},J.a.select({android:{fontSize:12},default:{fontSize:15}})),listItemButton:Object(b.a)({},J.a.select({android:{marginLeft:6},default:{marginLeft:8}})),convertFileBox:{alignSelf:"center",flexDirection:"row",marginTop:10},downloadFileBox:{justifyContent:"center",alignSelf:"center",marginTop:10}}),pe=ue,fe=n(53),he=n(160),xe=n(205),be=function(e){var t=je.textStyle,n=(je.viewStyle,je.titleStyle),r=je.positionStyle;return e.isStudent?Object(k.jsx)(xe.a,{onPress:function(){e.onPress(e.discipline)},underlayColor:P,children:Object(k.jsxs)(X,{children:[Object(k.jsx)(v.a,{style:r,children:e.discipline.POSITION}),Object(k.jsx)(v.a,{style:n,children:e.discipline.DISCIPLINE_NAME}),Object(k.jsxs)(v.a,{style:t,children:[e.discipline.START_TIME," - ",e.discipline.END_TIME]}),e.discipline.FIO_TEACHER1?Object(k.jsxs)(v.a,{style:t,children:[e.discipline.FIO_TEACHER1,e.discipline.FIO_TEACHER2?", "+e.discipline.FIO_TEACHER2:null]}):null,e.discipline.WEEK?Object(k.jsxs)(v.a,{style:t,children:["\u043d\u0430 \u043d\u0435\u0434\u0435\u043b\u044f\u0445: ",e.discipline.WEEK]}):null,Object(k.jsx)(v.a,{style:t,children:e.discipline.SYM_ROOM})]})}):Object(k.jsx)(xe.a,{onPress:function(){e.onPress(e.discipline)},underlayColor:P,children:Object(k.jsxs)(X,{children:[Object(k.jsx)(v.a,{style:r,children:e.discipline.POSITION}),Object(k.jsx)(v.a,{style:n,children:e.discipline.DISCIPLINE_NAME}),Object(k.jsxs)(v.a,{style:t,children:[e.discipline.START_TIME," - ",e.discipline.END_TIME]}),e.discipline.STUDY_GROUP?Object(k.jsx)(v.a,{style:t,children:e.discipline.STUDY_GROUP}):null,e.discipline.WEEK?Object(k.jsxs)(v.a,{style:t,children:["\u043d\u0430 \u043d\u0435\u0434\u0435\u043b\u044f\u0445: ",e.discipline.WEEK]}):null,Object(k.jsx)(v.a,{style:t,children:e.discipline.SYM_ROOM})]})})},je=x.a.create({textStyle:{fontSize:16,color:R.colors.text2},positionStyle:{fontSize:E,fontWeight:"bold",color:R.colors.text},titleStyle:{fontSize:E,color:R.colors.text},viewStyle:Object(b.a)({backgroundColor:R.colors.card,borderRadius:3,margin:8,padding:6},J.a.select({android:{elevation:2},default:{boxShadow:N}}))}),me=function(e){var t=ke.textStyle,n=(ke.viewStyle,ke.titleStyle),r=ke.underline,s=e.teacher,o=s.NAME,a=s.SURNAME,c=s.PATRONYMIC,i=s.CABINET,l=s.MAIN_SUBDIVISION,u=s.EMAIL,d=s.SITE_LINK,p=s.PORTRAIT_URL;return"web"===J.a.OS?o?Object(k.jsx)(X,{children:Object(k.jsxs)(h.a,{style:ke.mainBox,children:[Object(k.jsx)(T.a,{style:ke.img,source:p||A}),Object(k.jsxs)(h.a,{style:ke.profile_fields_box,children:[Object(k.jsxs)(v.a,{style:[n,r],onPress:function(){return ae.a.openURL(d)},children:[a," ",o," ",c]}),Object(k.jsxs)(v.a,{style:t,children:["\u041a\u0430\u0444\u0435\u0434\u0440\u0430 ",l," ",i]}),Object(k.jsx)(v.a,{style:[t,r],selectable:!0,children:u})]})]})}):null:o?Object(k.jsxs)(X,{children:[Object(k.jsxs)(v.a,{style:[n,r],onPress:function(){return ae.a.openURL(d)},children:[a," ",o," ",c]}),Object(k.jsxs)(v.a,{style:t,children:["\u041a\u0430\u0444\u0435\u0434\u0440\u0430 ",l," ",i]}),Object(k.jsx)(v.a,{style:[t,r],selectable:!0,children:u})]}):null},ke=x.a.create({textStyle:{fontSize:16,color:R.colors.text2,flexShrink:1},profile_fields_box:{flexDirection:"column",flexShrink:1,justifyContent:"center",alignItems:"center",maxWidth:700},img:{width:100,height:100,borderRadius:50,marginRight:12,alignItems:"center"},titleStyle:{fontSize:E,color:R.colors.text,flexShrink:1},viewStyle:Object(b.a)({borderRadius:3,margin:8,padding:6,backgroundColor:R.colors.card},J.a.select({android:{elevation:2},default:{boxShadow:N}})),underline:{textDecorationLine:"underline"},mainBox:{flexDirection:"row"},infoBox:{flexDirection:"column"}}),Oe=(x.a.create({viewStyle:Object(b.a)({width:(C-96)/6,margin:8,borderRadius:3,alignItems:"center",padding:(C-96)/6>=38?6:2,backgroundColor:R.colors.text2},J.a.select({android:{elevation:2},default:{boxShadow:N}})),chosenStyle:{backgroundColor:R.colors.accent},textStyle:{color:M}}),function(e){e.reViewStyle;var t=e.text,n=(ge.viewStyle,ge.titleStyle);return Object(k.jsx)(xe.a,{onPress:function(){e.onPress()},underlayColor:P,children:Object(k.jsx)(X,{children:Object(k.jsx)(v.a,{style:n,children:t})})})}),ge=x.a.create({titleStyle:{fontSize:E,color:R.colors.text,textAlign:"center"},viewStyle:Object(b.a)({borderRadius:3,margin:8,padding:6,backgroundColor:R.colors.card},J.a.select({android:{elevation:2},default:{boxShadow:N}}))});Date.prototype.getWeek=function(){var e=new Date(this.getTime());e.setHours(0,0,0,0),e.setDate(e.getDate()+3-(e.getDay()+6)%7);var t=new Date(e.getFullYear(),0,4);return 1+Math.round(((e.getTime()-t.getTime())/864e5-3+(t.getDay()+6)%7)/7)},Date.prototype.getMonthName=function(){return["\u044f\u043d\u0432\u0430\u0440\u044f","\u0444\u0435\u0432\u0440\u0430\u043b\u044f","\u043c\u0430\u0440\u0442\u0430","\u0430\u043f\u0440\u0435\u043b\u044f","\u043c\u0430\u044f","\u0438\u044e\u043d\u044f","\u0438\u044e\u043b\u044f","\u0430\u0432\u0433\u0443\u0441\u0442\u0430","\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f","\u043e\u043a\u0442\u044f\u0431\u0440\u044f","\u043d\u043e\u044f\u0431\u0440\u044f","\u0434\u0435\u043a\u0430\u0431\u0440\u044f"][new Date(this.getTime()).getMonth()]},he.b.locales.ru={monthNames:["\u042f\u043d\u0432\u0430\u0440\u044c","\u0424\u0435\u0432\u0440\u0430\u043b\u044c","\u041c\u0430\u0440\u0442","\u0410\u043f\u0440\u0435\u043b\u044c","\u041c\u0430\u0439","\u0418\u044e\u043d\u044c","\u0418\u044e\u043b\u044c","\u0410\u0432\u0433\u0443\u0441\u0442\u044c","\u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c","\u041e\u043a\u0442\u044f\u0431\u0440\u044c","\u041d\u043e\u044f\u0431\u0440\u044c","\u0414\u0435\u043a\u0430\u0431\u0440\u044c"],monthNamesShort:["\u042f\u043d\u0432","\u0424\u0435\u0432","\u041c\u0430\u0440","\u0410\u043f\u0440","\u041c\u0430\u0439","\u0418\u044e\u043d","\u0418\u044e\u043b","\u0410\u0432\u0433","\u0421\u0435\u043d","\u041e\u043a\u0442","\u041d\u043e\u044f","\u0414\u0435\u043a"],dayNames:["\u0412\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u0435","\u041f\u043e\u043d\u0435\u0434\u0435\u043b\u044c\u043d\u0438\u043a","\u0412\u0442\u043e\u0440\u043d\u0438\u043a","\u0421\u0440\u0435\u0434\u0430","\u0427\u0435\u0442\u0432\u0435\u0440\u0433","\u041f\u044f\u0442\u043d\u0438\u0446\u0430","\u0421\u0443\u0431\u0431\u043e\u0442\u0430"],dayNamesShort:["\u0412\u0441","\u041f\u043d","\u0412\u0442","\u0421\u0440","\u0427\u0442","\u041f\u0442","\u0421\u0443\u0431"],today:"\u0421\u0435\u0433\u043e\u0434\u043d\u044f'\u0421\u0433"},he.b.defaultLocale="ru";var ye=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;Object(u.a)(this,n),(r=t.call(this,e)).updateDay=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,s,o,a,c,l,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.state,s=n.disArr,o=n.currentDay,a=n.weekNum,c=t.getWeek()-o.getWeek(),l=a+c,e.next=5,r.findCurrentDisciplines(s,t,l);case 5:u=e.sent,r.setState({currentdisArr:u,currentDay:t,weekNum:l,isExtended:!1});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.chooseDisciplineTeacher=function(e){r.setState({isExtended:!0,START_TIME:e.START_TIME,DAY_DATE:e.DAY_DATE,STUDY_GROUP:e.STUDY_GROUP})},r.chooseDiscipline=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,s,o,a,c,l,u,d,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=(n=r.makeIdsArray(t)).length){e.next=3;break}return e.abrupt("return");case 3:s=[],e.prev=4,o=Object(fe.a)(n),e.prev=6,o.s();case 8:if((a=o.n()).done){e.next=37;break}return c=a.value,e.prev=10,l={access_token_cookie:r.state.accessToken,refresh_token_cookie:r.state.refreshToken,id:c},e.next=14,fetch(U+"/get_teacher_info",{mode:"cors",method:"POST",body:JSON.stringify(l),headers:{"Content-Type":"application/json"}});case 14:if(200!=(u=e.sent).status){e.next=22;break}return e.next=18,u.json();case 18:d=e.sent.json,s.push(d[0]),e.next=30;break;case 22:if(400!=u.status){e.next=26;break}r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=30;break;case 26:return e.next=28,u.json();case 28:p=e.sent,console.log(p.message);case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(10),console.log("catch chooseDiscipline: ",e.t0.message);case 35:e.next=8;break;case 37:e.next=42;break;case 39:e.prev=39,e.t1=e.catch(6),o.e(e.t1);case 42:return e.prev=42,o.f(),e.finish(42);case 45:e.next=50;break;case 47:e.prev=47,e.t2=e.catch(4),console.error(e.t2);case 50:r.setState({isExtended:!0,teachersArr:s});case 51:case"end":return e.stop()}}),e,null,[[4,47],[6,39,42,45],[10,32]])})));return function(t){return e.apply(this,arguments)}}(),r.cancelDiscepline=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.setState({teachersArr:[],isExtended:!1});case 1:case"end":return e.stop()}}),e)}))),r.startWithToken=Object(l.a)(i.a.mark((function e(){var t,n,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=JSON,e.next=4,F.a.getItem("userProfile");case 4:e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1),n=t.access_token,s=t.refresh_token,o=t.is_student,r.setState({accessToken:n,refreshToken:s,isStudent:o}),r.loadWeekNumber(),e.next=17;break;case 13:e.prev=13,e.t2=e.catch(0),console.log("catched startWithToken",e.t2.message),r.props.appFunctions.redirect({accessToken:null,refreshToken:null,isStudent:null});case 17:case"end":return e.stop()}}),e,null,[[0,13]])}))),r.loadStudentData=Object(l.a)(i.a.mark((function e(){var t,n,s,o,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={access_token_cookie:r.state.accessToken,refresh_token_cookie:r.state.refreshToken},e.next=4,fetch(U+"/get_student_info",{mode:"cors",method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 4:if(200!=(n=e.sent).status){e.next=14;break}return e.next=8,n.json();case 8:s=e.sent.json[0],o={ID:s.ID,SYM_GROUP:s.SYM_GROUP,SYM_FACULTET:s.SYM_FACULTET,NAME:s.NAME,SURNAME:s.SURNAME,PATRONYMIC:s.PATRONYMIC,ID_PLAN:s.ID_PLAN,YEAR_ADMISSION:s.YEAR_ADMISSION,ID_SPECIALIZATION:s.ID_SPECIALIZATION,ID_FACULTET:s.ID_FACULTET,ID_GROUP:s.ID_GROUP},r.setState(o),r.loadScheduleStudent(),e.next=22;break;case 14:if(400!=n.status){e.next=18;break}r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=22;break;case 18:return e.next=20,n.json();case 20:a=e.sent,console.log(a.message);case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),console.log("catch loadUserData: ",e.t0.message);case 27:case"end":return e.stop()}}),e,null,[[0,24]])}))),r.loadTeacherID=Object(l.a)(i.a.mark((function e(){var t,n,s,o,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={access_token_cookie:r.state.accessToken,refresh_token_cookie:r.state.refreshToken},e.next=4,fetch(U+"/get_teacher_id",{mode:"cors",method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 4:if(200!=(n=e.sent).status){e.next=14;break}return e.next=8,n.json();case 8:s=e.sent.json[0],o={ID:s.ID_PERSON},r.setState(o),r.loadTeacherData(),e.next=22;break;case 14:if(400!=n.status){e.next=18;break}r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=22;break;case 18:return e.next=20,n.json();case 20:a=e.sent,console.log(a.message);case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),console.log("catch loadTeacherID: ",e.t0.message);case 27:case"end":return e.stop()}}),e,null,[[0,24]])}))),r.loadTeacherData=Object(l.a)(i.a.mark((function e(){var t,n,s,o,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={access_token_cookie:r.state.accessToken,refresh_token_cookie:r.state.refreshToken,id:r.state.ID},e.next=4,fetch(U+"/get_teacher_info",{mode:"cors",method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 4:if(200!=(n=e.sent).status){e.next=14;break}return e.next=8,n.json();case 8:s=e.sent.json[0],o={ID:s.ID,NAME:s.NAME,SURNAME:s.SURNAME,PATRONYMIC:s.PATRONYMIC,FIO:s.FIO,DEGREE:s.DEGREE,POST:s.POST,MAIN_SUBDIVISION:s.MAIN_SUBDIVISION,CABINET:s.CABINET,EMAIL:s.EMAIL,SITE_LINK:s.SITE_LINK,PORTRAIT_URL:s.PORTRAIT_URL},r.setState(o),r.loadScheduleTeacher(),e.next=22;break;case 14:if(400!=n.status){e.next=18;break}r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=22;break;case 18:return e.next=20,n.json();case 20:a=e.sent,console.log(a.message);case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),console.log("catch loadUserData: ",e.t0.message);case 27:case"end":return e.stop()}}),e,null,[[0,24]])}))),r.loadScheduleStudent=Object(l.a)(i.a.mark((function e(){var t,n,s,o,a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null!=(t={access_token_cookie:r.state.accessToken,refresh_token_cookie:r.state.refreshToken,id:r.state.ID_GROUP}).id){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,fetch(U+"/student_schedule",{mode:"cors",method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 6:if(200!=(n=e.sent).status){e.next=18;break}return e.next=10,n.json();case 10:return s=e.sent.json,o=s,e.next=14,r.findCurrentDisciplines(o);case 14:a=e.sent,r.setState({disArr:o,currentdisArr:a}),e.next=26;break;case 18:if(400!=n.status){e.next=22;break}r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=26;break;case 22:return e.next=24,n.json();case 24:c=e.sent,console.log(c.message);case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(0),console.log("catch loadScheduleStudent: ",e.t0.message);case 31:case"end":return e.stop()}}),e,null,[[0,28]])}))),r.loadScheduleTeacher=Object(l.a)(i.a.mark((function e(){var t,n,s,o,a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null!=(t={access_token_cookie:r.state.accessToken,refresh_token_cookie:r.state.refreshToken,id:r.state.ID}).id){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,fetch(U+"/teacher_schedule",{mode:"cors",method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 6:if(200!=(n=e.sent).status){e.next=18;break}return e.next=10,n.json();case 10:return s=e.sent.json,o=s,e.next=14,r.findCurrentDisciplines(o);case 14:a=e.sent,r.setState({disArr:o,currentdisArr:a}),e.next=26;break;case 18:if(400!=n.status){e.next=22;break}r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=26;break;case 22:return e.next=24,n.json();case 24:c=e.sent,console.log(c.message);case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(0),console.log("catch loadScheduleTeacher: ",e.t0.message);case 31:case"end":return e.stop()}}),e,null,[[0,28]])}))),r.loadWeekNumber=Object(l.a)(i.a.mark((function e(){var t,n,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={access_token_cookie:r.state.accessToken,refresh_token_cookie:r.state.refreshToken},e.next=4,fetch(U+"/week_num",{mode:"cors",method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 4:if(200!=(n=e.sent).status){e.next=13;break}return e.next=8,n.json();case 8:s=e.sent.json[0],r.setState({weekNum:s.WEEK}),r.state.isStudent?r.loadStudentData():r.loadTeacherID(),e.next=21;break;case 13:if(400!=n.status){e.next=17;break}r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=21;break;case 17:return e.next=19,n.json();case 19:o=e.sent,console.log(o.message);case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),console.log("catch loadWeekNumber: ",e.t0.message);case 26:case"end":return e.stop()}}),e,null,[[0,23]])}))),r.createChat=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,s,o,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={access_token_cookie:r.state.accessToken,refresh_token_cookie:r.state.refreshToken,id:t},e.next=4,fetch(U+"/chat/create_chat",{mode:"cors",method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}});case 4:if(200!=(s=e.sent).status){e.next=12;break}return e.next=8,s.json();case 8:o=e.sent.json[0],r.props.navigation.navigate("Chat",{room_id:o.room_id,my_id:o.my_id}),e.next=20;break;case 12:if(400!=s.status){e.next=16;break}r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=20;break;case 16:return e.next=18,s.json();case 18:a=e.sent,console.log(a.message);case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),console.log("catch createChat: ",e.t0.message);case 25:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t){return e.apply(this,arguments)}}();var s=new Date;return s.setHours(0,0,0,0),r.state={weekNum:-1,disArr:[],currentdisArr:[],currentDay:s,isExtended:!1,teachersArr:[],START_TIME:null,DAY_DATE:null,STUDY_GROUP:null,accessToken:null,refreshToken:null,isStudent:null,ID:null,NAME:null,SURNAME:null,PATRONYMIC:null,SYM_GROUP:null,SYM_FACULTET:null,ID_PLAN:null,YEAR_ADMISSION:null,ID_SPECIALIZATION:null,ID_FACULTET:null,ID_GROUP:null,FIO:null,DEGREE:null,POST:null,MAIN_SUBDIVISION:null,CABINET:null,EMAIL:null,SITE_LINK:null,PORTRAIT_URL:null},r}return Object(d.a)(n,[{key:"findCurrentDisciplines",value:function(e,t,n){var r=this;if(1==arguments.length){var s=this.state,o=s.currentDay,a=s.weekNum,c=Number.isInteger(a/2)?1:2,i=e.filter((function(e){if(r.state.isStudent){if(o.getDay()===e.DAY_NUMBER&&(e.FREQUENCY>=3||c===e.FREQUENCY))return!0}else{var t=new Date(e.DAY_DATE);if(e.FREQUENCY=1,e.DAY_NUMBER=t.getDay(),o.toDateString()==t.toDateString())return!0}}));return a<0||a>18?[]:i.sort((function(e,t){return e.POSITION-t.POSITION}))}var l=Number.isInteger(n/2)?1:2,u=e.filter((function(e){if(r.state.isStudent){if(t.getDay()===e.DAY_NUMBER&&(e.FREQUENCY>=3||l===e.FREQUENCY))return!0}else{var n=new Date(e.DAY_DATE);if(e.FREQUENCY=1,e.DAY_NUMBER=n.getDay(),t.toDateString()==n.toDateString())return!0}}));return n<0||n>18?[]:u.sort((function(e,t){return e.POSITION-t.POSITION}))}},{key:"makeIdsArray",value:function(e){var t=[];return e.ID_TEACHER1&&t.push(parseInt(e.ID_TEACHER1)),e.ID_TEACHER2&&t.push(parseInt(e.ID_TEACHER2)),e.ID_TEACHER3&&t.push(parseInt(e.ID_TEACHER3)),e.ID_TEACHER4&&t.push(parseInt(e.ID_TEACHER4)),t}},{key:"componentDidMount",value:function(){this.startWithToken()}},{key:"render",value:function(){var e=this,t=this.state,n=(t.disArr,t.currentdisArr),r=t.currentDay,s=t.weekNum,o=t.isExtended,a=t.teachersArr,c=t.isStudent,i=ve.description,l=ve.textTitleStyle,u=ve.center,d=ve.calendar,p=[],f=new Date(r);0==r.getDay()?f.setDate(r.getDate()-6):f.setDate(r.getDate()-r.getDay()+1);for(var x=0;x<6;x++){var b=new Date(f);b.setDate(f.getDate()+x),p.push(b)}var j=Object(k.jsx)(h.a,{style:{flex:1,minWidth:300},children:o?c?Object(k.jsxs)(h.a,{children:[Object(k.jsx)(v.a,{style:[u,l,{marginTop:8}],children:"\u041f\u0420\u0415\u041f\u041e\u0414\u0410\u0412\u0410\u0422\u0415\u041b\u0418"}),a.map((function(t,n){return Object(k.jsxs)(h.a,{style:{marginTop:8},children:[Object(k.jsx)(me,{teacher:t}),Object(k.jsx)(Oe,{text:"\u0427\u0410\u0422",onPress:function(){return e.createChat(t.ID)}})]},t.ID)})),Object(k.jsx)(Oe,{text:"\u041d\u0410\u0417\u0410\u0414",onPress:this.cancelDiscepline})]}):Object(k.jsxs)(h.a,{style:{alignItems:"center"},children:[Object(k.jsx)(Oe,{text:"\u0421\u041e\u0417\u0414\u0410\u0422\u042c \u0417\u0410\u0414\u0410\u041d\u0418\u0415",onPress:function(){return e.props.navigation.navigate("AddTask",{date:e.state.DAY_DATE,time:e.state.START_TIME,group:encodeURIComponent(e.state.STUDY_GROUP)})}}),Object(k.jsx)(Oe,{text:"\u041d\u0410\u0417\u0410\u0414",onPress:this.cancelDiscepline})]}):Object(k.jsx)(h.a,{children:0==n.length?Object(k.jsx)(v.a,{style:[u,l,{marginTop:8}],children:"\u041d\u0415\u0422 \u0417\u0410\u041d\u042f\u0422\u0418\u0419"}):n.map((function(t,n){return Object(k.jsx)(be,{discipline:t,isStudent:e.state.isStudent,onPress:e.state.isStudent?e.chooseDiscipline:function(){return e.chooseDisciplineTeacher(t)}},n)}))})});return Object(k.jsx)(ce.a,{style:ve.mainScroll,contentContainerStyle:{flexDirection:"row",justifyContent:"center"},children:Object(k.jsxs)(h.a,{style:ve.container,children:[Object(k.jsx)(h.a,{style:i,children:Object(k.jsxs)(v.a,{style:l,children:["\u0412\u044b\u0431\u0440\u0430\u043d\u043e: ",r.getDate()," ",r.getMonthName(),s<0||s>18?null:", "+s+" \u043d\u0435\u0434\u0435\u043b\u044f"," "]})}),Object(k.jsxs)(h.a,{style:{flexDirection:"row",flexWrap:"wrap",alignItems:"flex-start",justifyContent:"center"},children:[Object(k.jsx)(h.a,{children:Object(k.jsx)(he.a,{style:d,onDayPress:function(t){e.updateDay(new Date(t.year,t.month-1,t.day))},current:this.state.currentDay,renderArrow:function(e){return Object(k.jsx)(v.a,{style:{color:R.colors.accent},children:"left"==e?"<":">"})},firstDay:1,theme:{backgroundColor:R.colors.card,calendarBackground:R.colors.card,textSectionTitleColor:R.colors.text2,textSectionTitleDisabledColor:R.colors.text2,selectedDayBackgroundColor:R.colors.accent,selectedDayTextColor:R.colors.text,todayTextColor:R.colors.accent,dayTextColor:R.colors.text,textDisabledColor:R.colors.text2,dotColor:"#00adf5",selectedDotColor:"#ffffff",arrowColor:R.colors.accent,disabledArrowColor:"#d9e1e8",monthTextColor:R.colors.accent,indicatorColor:R.colors.accent,textDayFontFamily:"monospace",textMonthFontFamily:"monospace",textDayHeaderFontFamily:"monospace",textDayFontWeight:"300",textMonthFontWeight:"bold",textDayHeaderFontWeight:"300",textDayFontSize:16,textMonthFontSize:16,textDayHeaderFontSize:16}})}),j]})]})})}}]),n}(r.Component),ve=x.a.create({mainScroll:{backgroundColor:R.colors.background},container:{paddingBottom:16,maxWidth:700,flex:1},dayListStyle:{flexDirection:"row"},description:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingHorizontal:6,marginVertical:8},textTitleStyle:{color:R.colors.text2,fontSize:E},center:{textAlign:"center"},calendar:{margin:8,backgroundColor:R.colors.card,borderRadius:3}}),Se=ye,Te=n(130),_e=(n(394),null),Ie=[],we=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this,e)).startWithToken=Object(l.a)(i.a.mark((function e(){var t,n,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=JSON,e.next=4,F.a.getItem("userProfile");case 4:e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1),n=t.access_token,s=t.refresh_token,o=t.is_student,r._isMounted&&r.setState({accessToken:n,refreshToken:s,isStudent:o}),r.loadUserData(),r.loadUserTasks(),e.next=18;break;case 14:e.prev=14,e.t2=e.catch(0),console.log("catched startWithToken",e.t2.message),r.props.appFunctions.redirect({accessToken:null,refreshToken:null,isStudent:null});case 18:case"end":return e.stop()}}),e,null,[[0,14]])}))),r.loadUserData=Object(l.a)(i.a.mark((function e(){var t,n,s,o,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={access_token_cookie:r.state.accessToken,refresh_token_cookie:r.state.refreshToken},e.next=4,fetch(U+"/get_student_info",{mode:"cors",method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 4:if(200!=(n=e.sent).status){e.next=14;break}return e.next=8,n.json();case 8:s=e.sent.json[0],o={ID:s.ID,SYM_GROUP:s.SYM_GROUP,SYM_FACULTET:s.SYM_FACULTET,NAME:s.NAME,SURNAME:s.SURNAME,PATRONYMIC:s.PATRONYMIC,ID_PLAN:s.ID_PLAN,YEAR_ADMISSION:s.YEAR_ADMISSION,ID_SPECIALIZATION:s.ID_SPECIALIZATION,ID_FACULTET:s.ID_FACULTET,ID_GROUP:s.ID_GROUP},_e=JSON.parse(JSON.stringify(o)),r._isMounted&&r.setState(o),e.next=22;break;case 14:if(400!=n.status){e.next=18;break}r._isMounted&&r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=22;break;case 18:return e.next=20,n.json();case 20:a=e.sent,console.log(a.message);case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),console.log("catch loadUserData: ",e.t0.message);case 27:case"end":return e.stop()}}),e,null,[[0,24]])}))),r.loadUserTasks=Object(l.a)(i.a.mark((function e(){var t,n,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={access_token_cookie:r.state.accessToken,refresh_token_cookie:r.state.refreshToken},e.next=4,fetch(U+"/solutions_list",{mode:"cors",method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 4:if(200!=(n=e.sent).status){e.next=13;break}return e.next=8,n.json();case 8:s=e.sent,Ie=s.data,r._isMounted&&r.setState({solutions:s.data}),e.next=21;break;case 13:if(400!=n.status){e.next=17;break}r._isMounted&&r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=21;break;case 17:return e.next=19,n.json();case 19:o=e.sent,console.log(o.message);case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),console.log("catch loadUserTasks: ",e.t0.message);case 26:case"end":return e.stop()}}),e,null,[[0,23]])}))),r.DownloadFile=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,r,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null===t||void 0===t?void 0:t.path,r=n||(null===(s=Ie[t])||void 0===s||null===(o=s.file)||void 0===o?void 0:o.path),console.log("download",r),e.next=5,ae.a.openURL(r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.ItemDelete=function(){var e=Object(l.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ie=Ie.map((function(e,n){return n==t?Object(b.a)(Object(b.a)({},e),{},{status:0,file:{}}):e})),r.setState({solutions:Ie});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.ChooseFile=function(){var e=Object(l.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(ie.a)({multiple:!1,copyToCacheDirectory:!0,type:"*/*"}).then((function(e){if("success"==e.type){e.type=e.name.indexOf(".")<0?"":/\.([0-9a-z]+)(?:[\?#]|$)/.exec(e.name)[0].toLocaleLowerCase(),e.extension=e.type.substring(1);var n=!1;if(-1!="pdf;".split(";").indexOf(e.extension)&&(n=!0),-1!="xlsx;xlsm;xlsb;xlam;xltx;xltm;xls;xlt;xla;xlm;xlw;odc;ods;prn;csv;dsn;mdb;mde;accdb;accde;dbc;iqy;dqy;rqy;oqy;cub;atom;atomsvc;dbf;xll;xlb;slk;dif;xlk;bak;pptx;ppt;pptm;ppsx;pps;ppsm;potx;pot;potm;odp;thmx;docx;docm;doc;ppam;ppa;docx;docm;dotx;dotm;doc;odt;docx;docm;doc;dotx;dotm;dotx;dotm;rtf;odt;doc;wpd;doc".split(";").indexOf(e.extension)&&(n=!0),-1!="png;jpg;jpeg".split(";").indexOf(e.extension)&&(n=!0),-1!="txt;c;h;cpp;cs;java;json;js;php;py;asm;sql;html;xml;yaml;md".split(";").indexOf(e.extension)&&(n=!0),n){var s=r.searchBufferedSolutions(t),o=Ie.map((function(t,n){return n==s?Object(b.a)(Object(b.a)({},t),{},{status:3,file:e}):t}));if("web"==J.a.OS)Ie=o,r.setState({solutions:o});else{var a=e.uri;le.a(a,{encoding:"base64"}).then((function(t){var n="data:application/vnd.custom-type;base64,"+t;e.uri=n,Ie=o,r.setState({solutions:o})})).catch((function(e){return console.log("wtf error")}))}console.log("chhose",Ie)}else alert("\u041d\u0435\u0432\u0435\u0440\u043d\u043e\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430")}})).catch((function(e){console.error("\u041e\u0448\u0438\u0431\u043a\u0430",e)}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.addFile=function(e){r.ChooseFile(e)},r.Confirm=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,s,o,a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.searchBufferedSolutions(t),Ie[n].file){e.next=3;break}return e.abrupt("return");case 3:return s=JSON.stringify({access_token:r.state.accessToken,refresh_token:r.state.refreshToken,id:Ie[n]._id,files:[Ie[n].file]}),e.prev=4,e.next=7,fetch(U+"/upload_solution",{mode:"cors",method:"POST",headers:{"Content-Type":"application/vnd.custom-type"},body:s});case 7:if(o=e.sent,console.log("response",o),200!=o.status){e.next=18;break}return e.next=12,o.json();case 12:a=e.sent,r.loadUserTasks(),Ie=Ie.map((function(e,t){return t==n?Object(b.a)(Object(b.a)({},e),{},{file:a.data,status:1}):e})),r.setState({solutions:Ie}),e.next=27;break;case 18:if(401!=o.status){e.next=22;break}r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=27;break;case 22:return e.next=24,o.json();case 24:c=e.sent,console.log(c.message),alert(c.message);case 27:r.setState({isLoading:!1}),e.next=34;break;case 30:e.prev=30,e.t0=e.catch(4),console.log("\u041e\u0448\u0438\u0431\u043a\u0430",e.t0),alert("\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435!");case 34:case"end":return e.stop()}}),e,null,[[4,30]])})));return function(t){return e.apply(this,arguments)}}(),r.exitApp=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.state.activatedExitButton){e.next=4;break}return r.setState({activatedExitButton:!0}),setTimeout((function(){r._isMounted&&r.setState({activatedExitButton:!1})}),1e3),e.abrupt("return");case 4:if(e.t0=r._isMounted,!e.t0){e.next=8;break}return e.next=8,F.a.removeItem("userProfile");case 8:r._isMounted&&r.props.appFunctions.redirect({accessToken:null,refreshToken:null,isStudent:null});case 9:case"end":return e.stop()}}),e)}))),r.state={isExtended:null,accessToken:null,refreshToken:null,isStudent:null,solutions:[],ID:null,SYM_GROUP:null,SYM_FACULTET:null,NAME:null,SURNAME:null,PATRONYMIC:null,ID_PLAN:null,YEAR_ADMISSION:null,ID_SPECIALIZATION:null,ID_FACULTET:null,ID_GROUP:null,activatedExitButton:!1},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.startWithToken()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"searchBufferedSolutions",value:function(e){return e}},{key:"render",value:function(){var e=this,t={uri:"https://sd.randgor.ru/app/student_placeholder.png"},n=Object(k.jsxs)(h.a,{style:De.profileBox,children:[Object(k.jsx)(h.a,{style:{position:"absolute",zIndex:2,right:0},children:Object(k.jsx)(Te.a,{onPress:function(){return e.exitApp()},children:Object(k.jsx)(ee.a,{color:this.state.activatedExitButton?R.colors.accent:R.colors.text2,name:"exit-to-app",size:24})})}),Object(k.jsx)(T.a,{style:De.img,source:t}),_e?Object(k.jsxs)(h.a,{style:De.profile_fields_box,children:[Object(k.jsxs)(v.a,{style:De.field_name,children:[_e.SURNAME," ",_e.NAME," ",_e.PATRONYMIC]}),Object(k.jsxs)(v.a,{style:De.field_group,children:[_e.SYM_FACULTET,", \u0413\u0440\u0443\u043f\u043f\u0430 ",_e.SYM_GROUP]})]}):Object(k.jsx)(h.a,{})]}),r=function(t){var n,r=e.searchBufferedSolutions(t);return n=e.state.isExtended==r?null:r,Object(k.jsx)(h.a,{style:De.listItemButton,children:Object(k.jsx)(I.a,{title:"\u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435 \ud834\udf12",onPress:function(){return e.setState({isExtended:n})},color:R.colors.accent})})},s=function(t){var n=e.searchBufferedSolutions(t),r=Ie[n];return Object(k.jsx)(h.a,{style:De.listItemButton,children:Object(k.jsx)(I.a,{title:"+",disabled:0!=r.status,onPress:function(){return e.addFile(t)},color:R.colors.accent})})},o=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(k.jsx)(h.a,{style:De.listItemButton,children:Object(k.jsx)(I.a,{color:R.colors.accent,title:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c",onPress:function(){return e.DownloadFile(n||t)}})})},a=function(t){return Object(k.jsx)(h.a,{style:De.listItemButton,children:Object(k.jsx)(I.a,{color:R.colors.accent,title:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c \u2713",onPress:function(){return e.Confirm(t)}})})},c=function(t){return Object(k.jsx)(h.a,{style:De.listItemButton,children:Object(k.jsx)(I.a,{title:"\u26cc",onPress:function(){return e.ItemDelete(t)},color:"#dc3545"})})},i=function(t,n){var r=e.searchBufferedSolutions(n);return e.state.isExtended==r?Object(k.jsxs)(h.a,{children:[Object(k.jsx)(v.a,{style:De.field_description,children:t.description}),t.methods.map((function(e,t){return l(e,t)}))]}):Object(k.jsx)(k.Fragment,{})},l=function(e,t){return Object(k.jsxs)(h.a,{style:De.downloadFileBox,children:[Object(k.jsx)(v.a,{style:[De.field_group,{paddingEnd:6}],children:e.name}),o(t,e)]},t)},u=Ie?Ie.map((function(e,t){var n,l;switch(e.status){case 0:n="\u041d\u0435 \u0441\u0434\u0430\u043d\u043e";break;case 1:n="\u041d\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0435";break;case 2:n="\u041f\u0440\u043e\u0432\u0435\u0440\u0435\u043d\u043e";break;case 3:n="\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443"}e.file&&(l=e.file.name);var u=new Date(e.date),d=0==u.getMinutes()?"00":u.getMinutes(),p=u.getDate()+"."+u.getMonth()+"."+u.getFullYear()+" "+u.getHours()+":"+d,f=Object(k.jsxs)(h.a,{style:De.listview,children:[Object(k.jsxs)(v.a,{style:De.listItemHeader,children:[t+1,". ",e.title," \u0434\u043e ",p," (",n,")"]}),Object(k.jsx)(v.a,{style:De.listItemHeader,children:i(e,t)}),Object(k.jsxs)(h.a,{style:De.buttons,children:[l&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(ee.a,{color:R.colors.text2,name:"file",size:24}),Object(k.jsx)(v.a,{style:De.field_task,children:l})]}),1==e.status&&o(t),3==e.status&&a(t),3==e.status&&c(t)]})]});return Object(k.jsxs)(h.a,{style:De.solutionsListBox,children:[f,Object(k.jsxs)(h.a,{style:De.buttons,children:[r(t),0==e.status&&s(t)]})]},t)})):Object(k.jsx)(h.a,{}),d=_e?Object(k.jsxs)(h.a,{style:De.field_info,children:[Object(k.jsx)(v.a,{style:De.field_name,children:"\u0421\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u0440\u0430\u0431\u043e\u0442:"}),u]}):Object(k.jsx)(h.a,{style:De.field_info});return Object(k.jsx)(ce.a,{style:De.mainScroll,contentContainerStyle:{flexDirection:"row",justifyContent:"center"},children:Object(k.jsxs)(h.a,{style:De.container,children:[Object(k.jsx)(X,{children:n}),Object(k.jsx)(X,{children:d})]})})}}]),n}(s.a.Component),De=x.a.create({mainScroll:{backgroundColor:R.colors.background},container:{paddingBottom:16,maxWidth:700,flex:1},listItemHeader:Object(b.a)({color:R.colors.text2,margin:10},J.a.select({android:{fontSize:12},default:{fontSize:15}})),profile_fields_box:{flexDirection:"column",flexShrink:1,justifyContent:"center",alignItems:"center",maxWidth:700},field_name:{margin:8,flexShrink:1,fontSize:20,color:R.colors.text,fontWeight:"bold"},field_description:{flexShrink:1,flexDirection:"column",flex:1,color:R.colors.text2,fontWeight:"bold"},field_group:{fontSize:18,color:R.colors.text2},img:{width:100,height:100,borderRadius:50,marginRight:12,alignItems:"center"},profileBox:{flexDirection:"row",flexWrap:"wrap",justifyContent:"center",flex:1,maxWidth:700},field_info:{flexDirection:"column",flex:1,maxWidth:700},listItemButton:Object(b.a)({},J.a.select({android:{marginLeft:6},default:{marginLeft:8}})),downloadFileBox:{alignItems:"center",justifyContent:"center",marginTop:8,flexDirection:"row"},solutionsListBox:{margin:8},listview:{backgroundColor:R.colors.background,borderRadius:4,alignItems:"center",flexDirection:"column",margin:4,flex:1},field_task:{color:R.colors.text2},buttons:{margin:8,flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"center",flex:1}}),Ce=we,Ee=null,Ae=[],Re=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this,e)).startWithToken=Object(l.a)(i.a.mark((function e(){var t,n,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=JSON,e.next=4,F.a.getItem("userProfile");case 4:e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1),n=t.access_token,s=t.refresh_token,o=t.is_student,r._isMounted&&r.setState({accessToken:n,refreshToken:s,isStudent:o}),r._isMounted&&r.loadTeacherID(),e.next=17;break;case 13:e.prev=13,e.t2=e.catch(0),console.log("catched startWithToken",e.t2.message),r._isMounted&&r.props.appFunctions.redirect({accessToken:null,refreshToken:null,isStudent:null});case 17:case"end":return e.stop()}}),e,null,[[0,13]])}))),r.loadTeacherID=Object(l.a)(i.a.mark((function e(){var t,n,s,o,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={access_token_cookie:r.state.accessToken,refresh_token_cookie:r.state.refreshToken},e.next=4,fetch(U+"/get_teacher_id",{mode:"cors",method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 4:if(200!=(n=e.sent).status){e.next=15;break}return e.next=8,n.json();case 8:s=e.sent.json[0],o={ID:s.ID_PERSON},r._isMounted&&r.setState(o),r._isMounted&&r.loadUserData(),r._isMounted&&r.loadUserTasks(),e.next=23;break;case 15:if(400!=n.status){e.next=19;break}r._isMounted&&r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=23;break;case 19:return e.next=21,n.json();case 21:a=e.sent,console.log(a.message);case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(0),console.log("catch loadTeacherID: ",e.t0.message);case 28:case"end":return e.stop()}}),e,null,[[0,25]])}))),r.loadUserData=Object(l.a)(i.a.mark((function e(){var t,n,s,o,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={access_token_cookie:r.state.accessToken,refresh_token_cookie:r.state.refreshToken,id:80087},e.next=4,fetch(U+"/get_teacher_info",{mode:"cors",method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 4:if(200!=(n=e.sent).status){e.next=14;break}return e.next=8,n.json();case 8:s=e.sent.json[0],o={ID:s.ID,NAME:s.NAME,SURNAME:s.SURNAME,PATRONYMIC:s.PATRONYMIC,FIO:s.FIO,DEGREE:s.DEGREE,POST:s.POST,MAIN_SUBDIVISION:s.MAIN_SUBDIVISION,CABINET:s.CABINET,EMAIL:s.EMAIL,SITE_LINK:s.SITE_LINK,PORTRAIT_URL:s.PORTRAIT_URL},Ee=JSON.parse(JSON.stringify(o)),r._isMounted&&r.setState(o),e.next=22;break;case 14:if(400!=n.status){e.next=18;break}r._isMounted&&r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=22;break;case 18:return e.next=20,n.json();case 20:a=e.sent,console.log(a.message);case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),console.log("catch loadUserData: ",e.t0.message);case 27:case"end":return e.stop()}}),e,null,[[0,24]])}))),r.loadUserTasks=Object(l.a)(i.a.mark((function e(){var t,n,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={access_token:r.state.accessToken,refresh_token:r.state.refreshToken},e.next=4,fetch(U+"/executed_list",{mode:"cors",method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 4:if(200!=(n=e.sent).status){e.next=13;break}return e.next=8,n.json();case 8:s=e.sent,Ae=s,r._isMounted&&r.setState({solutions:s}),e.next=21;break;case 13:if(401!=n.status){e.next=17;break}r._isMounted&&r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=21;break;case 17:return e.next=19,n.json();case 19:o=e.sent,console.log(o.message);case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),console.log("catch loadUserTasks: ",e.t0.message);case 26:case"end":return e.stop()}}),e,null,[[0,23]])}))),r.ItemOpenInfo=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ae[t],r=n.file.path,e.next=4,ae.a.openURL(r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.SubmitTeacherAnswer=function(){var e=Object(l.a)(i.a.mark((function e(t,n){var s,o,a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=Ae[t],e.prev=1,o={access_token:r.state.accessToken,refresh_token:r.state.refreshToken,conclusion:n,solution_id:s.solution_id},e.next=5,fetch(U+"/upload_validation",{mode:"cors",method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}});case 5:if(200!=(a=e.sent).status){e.next=13;break}return e.next=9,a.json();case 9:e.sent,r.loadUserTasks(),e.next=21;break;case 13:if(401!=a.status){e.next=17;break}r._isMounted&&r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=21;break;case 17:return e.next=19,a.json();case 19:c=e.sent,console.log(c.message);case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(1),console.log("catch loadUserTasks: ",e.t0.message);case 26:case"end":return e.stop()}}),e,null,[[1,23]])})));return function(t,n){return e.apply(this,arguments)}}(),r.ItemAccept=function(){var e=Object(l.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.SubmitTeacherAnswer(t,!1);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.ItemDeny=function(){var e=Object(l.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.SubmitTeacherAnswer(t,!0);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.exitApp=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.state.activatedExitButton){e.next=4;break}return r.setState({activatedExitButton:!0}),setTimeout((function(){r._isMounted&&r.setState({activatedExitButton:!1})}),1e3),e.abrupt("return");case 4:if(e.t0=r._isMounted,!e.t0){e.next=8;break}return e.next=8,F.a.removeItem("userProfile");case 8:r._isMounted&&r.props.appFunctions.redirect({accessToken:null,refreshToken:null,isStudent:null});case 9:case"end":return e.stop()}}),e)}))),r.state={accessToken:null,refreshToken:null,isStudent:null,solutions:[],ID:null,NAME:null,SURNAME:null,PATRONYMIC:null,FIO:null,DEGREE:null,POST:null,MAIN_SUBDIVISION:null,CABINET:null,EMAIL:null,SITE_LINK:null,PORTRAIT_URL:null,activatedExitButton:!1},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.startWithToken()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this,t=this.props,n=(t.navigation,t.accessToken,t.refreshToken,null==Ee||null==Ee.PORTRAIT_URL?A:Ee.PORTRAIT_URL),r=null==Ee||null==Ee.MAIN_SUBDIVISION?Object(k.jsx)(k.Fragment,{}):Object(k.jsxs)(v.a,{style:Ne.field_group,children:["\u041a\u0430\u0444\u0435\u0434\u0440\u0430: ",Ee.MAIN_SUBDIVISION]}),s=null==Ee||null==Ee.CABINET?Object(k.jsx)(k.Fragment,{}):Object(k.jsxs)(v.a,{style:Ne.field_group,children:["\u041a\u0430\u0431\u0438\u043d\u0435\u0442: ",Ee.CABINET]}),o=null==Ee||null==Ee.DEGREE&&null==Ee.POST?Object(k.jsx)(k.Fragment,{}):Object(k.jsxs)(v.a,{style:Ne.field_group,children:[Ee.POST,Ee.DEGREE?", "+Ee.DEGREE:""]}),a=Object(k.jsxs)(h.a,{style:Ne.profileBox,children:[Object(k.jsx)(h.a,{style:{position:"absolute",zIndex:2,right:0},children:Object(k.jsx)(Te.a,{onPress:function(){return e.exitApp()},children:Object(k.jsx)(ee.a,{color:this.state.activatedExitButton?R.colors.accent:R.colors.text2,name:"exit-to-app",size:24})})}),Object(k.jsx)(T.a,{style:Ne.img,source:n}),Ee?Object(k.jsxs)(h.a,{style:Ne.profile_fields_box,children:[Object(k.jsxs)(v.a,{style:Ne.field_name,children:[Ee.SURNAME," ",Ee.NAME," ",Ee.PATRONYMIC]}),r,s,o]}):Object(k.jsx)(h.a,{})]}),c=Ae.map((function(t,n){console.log("next Prop",t);var r=t.title+" ("+t.description+")\n"+t.student_name+", "+t.group;return Object(k.jsxs)(h.a,{style:Ne.listview,children:[Object(k.jsx)(h.a,{style:{flex:1},children:Object(k.jsx)(v.a,{style:Ne.listItemHeader,children:r})}),Object(k.jsx)(h.a,{style:Ne.listItemButton,children:Object(k.jsx)(I.a,{title:"\ud834\udf12",onPress:function(){return e.ItemOpenInfo(n)}})}),Object(k.jsx)(h.a,{style:Ne.listItemButton,children:Object(k.jsx)(I.a,{title:"\u2713",onPress:function(){return e.ItemAccept(n)}})}),Object(k.jsx)(h.a,{style:Ne.listItemButton,children:Object(k.jsx)(I.a,{title:"\u26cc",onPress:function(){return e.ItemDeny(n)},color:"#dc3545"})})]},n)})),i=Ee?Object(k.jsxs)(h.a,{style:Ne.field_info,children:[0==Ae.length?Object(k.jsx)(v.a,{style:Ne.field_checkedHeader,children:"\u041d\u0435\u043f\u0440\u043e\u0432\u0435\u0440\u0435\u043d\u043d\u044b\u0435 \u0440\u0430\u0431\u043e\u0442\u044b \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442"}):Object(k.jsx)(v.a,{style:Ne.field_checkedHeader,children:"\u041d\u0435\u043f\u0440\u043e\u0432\u0435\u0440\u0435\u043d\u043d\u044b\u0435 \u0440\u0430\u0431\u043e\u0442\u044b:"}),0==Ae.length?Object(k.jsx)(h.a,{}):c]}):Object(k.jsx)(h.a,{style:Ne.field_info});return Object(k.jsx)(ce.a,{style:Ne.mainScroll,contentContainerStyle:{flexDirection:"row",justifyContent:"center"},children:Object(k.jsxs)(h.a,{style:Ne.container,children:[Object(k.jsx)(X,{children:a}),Object(k.jsx)(X,{children:i})]})})}}]),n}(s.a.Component),Ne=x.a.create({mainScroll:{backgroundColor:R.colors.background},container:{paddingBottom:16,maxWidth:700,flex:1},profile_fields_box:{flexDirection:"column",flexShrink:1,justifyContent:"center",alignItems:"center",maxWidth:700},listview:{backgroundColor:R.colors.background,borderRadius:4,alignItems:"center",flexDirection:"row",margin:4,flex:1},listItemHeader:Object(b.a)({color:R.colors.text2,margin:10},J.a.select({android:{fontSize:12},default:{fontSize:15}})),listItemButton:Object(b.a)({},J.a.select({android:{marginLeft:6},default:{marginLeft:8}})),field_name:{flexShrink:1,fontSize:20,color:R.colors.text,fontWeight:"bold"},field_group:{fontSize:18,color:R.colors.text2},field_checkedHeader:{fontSize:18,marginBottom:8,color:R.colors.text2},img:{width:100,height:100,borderRadius:50,marginRight:12,alignItems:"center"},profileBox:{flexDirection:"row",flexWrap:"wrap",justifyContent:"center",flex:1,maxWidth:700},field_info:{flexDirection:"column",flex:1,maxWidth:700}}),Me=Re,Pe=(s.a.Component,x.a.create({container:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:P},welcome:{fontSize:20,textAlign:"center",margin:10}})),Ue=x.a.create({main:{flexDirection:"row",justifyContent:"space-evenly",backgroundColor:R.colors.card},button:{overflow:"hidden",flex:1,paddingBottom:6,backgroundColor:R.colors.card,flexDirection:"row",justifyContent:"center",alignItems:"center"},text:{textColor:M,fontSize:20},icon:{marginTop:12,margin:8}}),Fe=Object(S.a)((function(e){var t=e.history;t.location.pathname.length<2&&t.push("/app/");var n=y.a.get("window").width>600,r=[{name:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f",href:"/app/",icon:"account-circle-outline"},{name:"\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435",href:"/app/schedule",icon:"timetable"},{name:"\u0427\u0430\u0442",href:"/app/rooms",icon:"chat-outline"},{name:"\u041a\u043e\u043d\u0432\u0435\u0440\u0442\u0435\u0440",href:"/app/converter",icon:"file-compare"}].map((function(e,r){var s=t.location.pathname==e.href||window.location.pathname.startsWith("/app/chat/")&&"/app/rooms"==e.href?R.colors.accent:R.colors.text2;return Object(k.jsxs)(Te.a,{style:Ue.button,onPress:function(){return t.push(e.href)},children:[Object(k.jsx)(ee.a,{name:e.icon,size:24,color:s,style:Ue.icon}),n?Object(k.jsx)(v.a,{color:s,style:[Ue.text,{color:s}],children:e.name}):Object(k.jsx)(h.a,{})]},r)}));return Object(k.jsx)(h.a,{style:Ue.main,children:r})})),Be=x.a.create({main:{flexDirection:"row",justifyContent:"space-evenly",backgroundColor:R.colors.card},button:{overflow:"hidden",flex:1,paddingBottom:6,backgroundColor:R.colors.card,flexDirection:"row",justifyContent:"center",alignItems:"center"},text:{textColor:M,fontSize:20},icon:{marginTop:12,margin:8}}),Le=Object(S.a)((function(e){var t=e.history;t.location.pathname.length<2&&t.push("/app/");var n=y.a.get("window").width>800,r=[{name:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f",href:"/app/",icon:"account-circle-outline"},{name:"\u0427\u0430\u0442",href:"/app/rooms",icon:"chat-outline"},{name:"\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435",href:"/app/schedule",icon:"timetable"},{name:"\u041a\u043e\u043d\u0432\u0435\u0440\u0442\u0435\u0440",href:"/app/converter",icon:"file-compare"}].map((function(e,r){var s=t.location.pathname==e.href||window.location.pathname.startsWith("/app/chat/")&&"/app/rooms"==e.href?R.colors.accent:R.colors.text2;return Object(k.jsxs)(Te.a,{style:Be.button,onPress:function(){return t.push(e.href)},children:[Object(k.jsx)(ee.a,{name:e.icon,size:24,color:s,style:Be.icon}),n?Object(k.jsx)(v.a,{color:s,style:[Be.text,{color:s}],children:e.name}):Object(k.jsx)(h.a,{})]},r)}));return Object(k.jsx)(h.a,{style:Be.main,children:r})})),We=n(177),ze=[],Ye=-1,Je=!1;function He(e){var t=this,n=e.navigation,s=e.appFunctions,o=Object(r.useState)([]),a=Object(Y.a)(o,2),c=(a[0],a[1]),u=Object(r.useState)(Ye),d=Object(Y.a)(u,2),p=(d[0],d[1]),f=Object(r.useState)({accessToken:null,refreshToken:null}),x=Object(Y.a)(f,2),b=x[0],j=x[1];"android"==J.a.OS&&(n=Object(We.useNavigation)());var m=function(){var e=Object(l.a)(i.a.mark((function e(){var n,r,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=JSON,e.next=4,F.a.getItem("userProfile");case 4:e.t1=e.sent,n=e.t0.parse.call(e.t0,e.t1),r=n.access_token,s=n.refresh_token,n.is_student,Je&&j({accessToken:r,refreshToken:s}),e.next=16;break;case 12:e.prev=12,e.t2=e.catch(0),console.log("catched startWithToken",e.t2.message),t.props.appFunctions.redirect({accessToken:null,refreshToken:null,isStudent:null});case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){Je=!0,m()}),[]),Object(r.useEffect)(Object(l.a)(i.a.mark((function e(){var t,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=b.accessToken){e.next=2;break}return e.abrupt("return");case 2:return t={access_token_cookie:b.accessToken,refresh_token_cookie:b.refreshToken},e.prev=3,e.next=6,fetch(U+"/chat/rooms",{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 6:return n=e.sent,e.next=9,n.json();case 9:r=e.sent,200==n.status?r[0]?(ze=r[0].rooms,Ye=r[0].usr_id,Je&&p(r[0].usr_id),Je&&c(ze)):(ze=[],Je&&c(ze),console.log("rooms array is empty")):(console.error("response status in rooms",n.status),s.tryRefreshToken(m)),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(3),Je&&s.tryRefreshToken(m),console.error("error in rooms:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[3,13]])}))),[b]),Object(r.useLayoutEffect)((function(){return function(){Je=!1}}),[]);var O=function(e){var t=e.item,r=e.key;return Object(k.jsx)(X,{style:Ge.nopadding,children:Object(k.jsxs)(Te.a,{style:Ge.dialogBox,onPress:function(){return e=t.room_id,r=Ye,void n.navigate("web"==J.a.OS?"Chat":"chat",{room_id:e,my_id:r});var e,r},children:[Object(k.jsx)(T.a,{style:Ge.img,source:{uri:null==t.img?A:t.img}}),Object(k.jsx)(v.a,{style:Ge.text,children:t.companionName}),t.status?Object(k.jsx)(h.a,{style:{justifyContent:"center"},children:Object(k.jsx)(ee.a,{name:"record-circle",size:E,color:R.colors.accent,style:Ge.icon})}):null]})},r)},g=0==ze.length?Object(k.jsx)(v.a,{style:Ge.noChatsPlaceholder,children:"\u041d\u0415\u0422 \u0427\u0410\u0422\u041e\u0412"}):ze.map((function(e,t){return O({item:e,key:t})}));return Object(k.jsx)(ce.a,{style:Ge.mainScroll,contentContainerStyle:{flexDirection:"row",justifyContent:"center"},children:Object(k.jsx)(h.a,{style:Ge.container,children:g})})}var Ge=x.a.create({mainScroll:{backgroundColor:R.colors.background},container:{paddingBottom:16,maxWidth:700,flex:1},dialogBox:{padding:15,flexDirection:"row",flexWrap:"wrap",justifyContent:"center",flex:1},noChatsPlaceholder:{color:R.colors.text2,textAlign:"center",fontSize:20,margin:16},text:{fontSize:16,color:R.colors.text,alignSelf:"center",flex:1,margin:4},img:{width:40,height:40,borderRadius:50,marginRight:8,alignItems:"center"},nopadding:{padding:0}}),qe=n(248),Ke=(n(468),function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this,e)).startWithToken=Object(l.a)(i.a.mark((function e(){var t,n,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=JSON,e.next=4,F.a.getItem("userProfile");case 4:e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1),n=t.access_token,s=t.refresh_token,r.setState({accessToken:n,refreshToken:s}),e.next=15;break;case 11:e.prev=11,e.t2=e.catch(0),console.log("catched startWithToken",e.t2.message),r.props.appFunctions.redirect({accessToken:null,refreshToken:null,isStudent:null});case 15:case"end":return e.stop()}}),e,null,[[0,11]])}))),r.ChooseFile=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(ie.a)({multiple:!1,copyToCacheDirectory:!0,type:"*/*"}).then((function(e){if("success"==e.type){e.type=e.name.indexOf(".")<0?"":/\.([0-9a-z]+)(?:[\?#]|$)/.exec(e.name)[0].toLocaleLowerCase(),e.extension=e.type.substring(1);var t=!1;if(-1!="pdf;".split(";").indexOf(e.extension)&&(t=!0),-1!="xlsx;xlsm;xlsb;xlam;xltx;xltm;xls;xlt;xla;xlm;xlw;odc;ods;prn;csv;dsn;mdb;mde;accdb;accde;dbc;iqy;dqy;rqy;oqy;cub;atom;atomsvc;dbf;xll;xlb;slk;dif;xlk;bak;pptx;ppt;pptm;ppsx;pps;ppsm;potx;pot;potm;odp;thmx;docx;docm;doc;ppam;ppa;docx;docm;dotx;dotm;doc;odt;docx;docm;doc;dotx;dotm;dotx;dotm;rtf;odt;doc;wpd;doc".split(";").indexOf(e.extension)&&(t=!0),-1!="png;jpg;jpeg".split(";").indexOf(e.extension)&&(t=!0),-1!="txt;c;h;cpp;cs;java;json;js;php;py;asm;sql;html;xml;yaml;md".split(";").indexOf(e.extension)&&(t=!0),t)if("web"==J.a.OS)r.setState({isAdded:!1}),r.setState({files:r.state.files.concat(e)});else{var n=e.uri;le.a(n,{encoding:"base64"}).then((function(t){var n="data:application/vnd.custom-type;base64,"+t;e.uri=n,r.setState({isAdded:!1}),r.setState({files:r.state.files.concat(e)})})).catch((function(e){return console.log("wtf error")}))}else alert("\u041d\u0435\u0432\u0435\u0440\u043d\u043e\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430")}})).catch((function(e){console.error("\u041e\u0448\u0438\u0431\u043a\u0430",e)}));case 1:case"end":return e.stop()}}),e)}))),r.Save=Object(l.a)(i.a.mark((function e(){var t,n,s,o,a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"android"==J.a.OS?(t=r.props.route.params.date,n=r.props.route.params.time,s=r.props.route.params.group):(t=r.props.navigation.getParam("date",-1),n=r.props.navigation.getParam("time",-1),s=r.props.navigation.getParam("group",-1)),t=new Date(decodeURIComponent(t)),n=decodeURIComponent(n),s=decodeURIComponent(s),t.setHours(n.substring(0,2),n.substring(3,5),0,0),o=JSON.stringify({access_token:r.state.accessToken,refresh_token:r.state.refreshToken,date:t,group:s,title:r.state.title,description:r.state.description,methods:r.state.files,file:{}}),e.prev=6,e.next=9,fetch(U+"/add_task",{mode:"cors",method:"POST",headers:{"Content-Type":"application/vnd.custom-type"},body:o});case 9:if(200!=(a=e.sent).status){e.next=18;break}return e.next=13,a.json();case 13:e.sent,"android"==J.a.OS?qe.a.show("\u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e",qe.a.SHORT):alert("\u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e"),r.props.navigation.goBack(),e.next=28;break;case 18:if(401!=a.status){e.next=23;break}console.log("appf",r.props.appFunctions),r.props.appFunctions.tryRefreshToken(r.startWithToken),e.next=28;break;case 23:return e.next=25,a.json();case 25:c=e.sent,console.log(c.message),alert(c.message);case 28:r.setState({isLoading:!1}),e.next=37;break;case 31:e.prev=31,e.t0=e.catch(6),console.log("\u041e\u0448\u0438\u0431\u043a\u0430",e.t0),alert("\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435!"),r.setState({isAdded:!1}),r.setState({isLoading:!1});case 37:case"end":return e.stop()}}),e,null,[[6,31]])}))),r.ItemDelete=function(){var e=Object(l.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.state.files.filter((function(e,n){return n!=t})),r.setState({isAdded:!1,resultConverted:{}}),r.setState({files:n});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.state={files:[],isLoading:!1,isAdded:!1,accessToken:null,refreshToken:null,title:"",description:""},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.startWithToken()}},{key:"bytesToSize",value:function(e){if(0==e)return"0 \u0411";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+" "+["\u0411","\u041a\u0411","\u041c\u0411","\u0413\u0411","\u0422\u0411"][t]}},{key:"render",value:function(){var e=this,t=(this.props.navigation,this.state.resultConverted,Object(k.jsx)(X,{children:Object(k.jsx)(h.a,{children:Object(k.jsxs)(h.a,{children:[Object(k.jsx)(v.a,{style:Ve.headerText,children:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"}),Object(k.jsx)(_.a,{style:Ve.input,onChangeText:function(t){return e.setState({title:t})},value:this.state.title,placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",placeholderTextColor:R.colors.text2}),Object(k.jsx)(v.a,{style:Ve.headerText,children:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0437\u0430\u0434\u0430\u0447\u0438"}),Object(k.jsx)(_.a,{style:Ve.input,onChangeText:function(t){return e.setState({description:t})},value:this.state.description,placeholder:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",placeholderTextColor:R.colors.text2,multiline:!0,numberOfLines:4})]})})})),n=Object(k.jsx)(X,{children:Object(k.jsx)(h.a,{style:Ve.inputBox,children:Object(k.jsx)(h.a,{style:Ve.selectFileBox,children:Object(k.jsx)(I.a,{color:R.colors.accent,title:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0444\u0430\u0439\u043b",disabled:!!this.state.isLoading,onPress:function(){return e.ChooseFile()}})})})}),r=Object(k.jsx)(X,{children:Object(k.jsx)(h.a,{style:Ve.inputBox,children:Object(k.jsx)(h.a,{children:Object(k.jsx)(I.a,{color:R.colors.accent,title:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",disabled:!(""!=this.state.title&""!=this.state.description),onPress:function(){return e.Save()}})})})}),s=this.state.files.map((function(t,n){return Object(k.jsxs)(h.a,{style:Ve.listview,children:[Object(k.jsx)(h.a,{style:{flex:1},children:Object(k.jsxs)(v.a,{style:Ve.listItemHeader,children:[n+1,". ",t.name," (",e.bytesToSize(t.size),")"]})}),Object(k.jsx)(h.a,{style:Ve.listItemButton,children:Object(k.jsx)(I.a,{disabled:!!e.state.isLoading,title:"\u26cc",onPress:function(){return e.ItemDelete(n)},color:"#dc3545"})})]},n)})),o=0==this.state.files.length?Object(k.jsx)(h.a,{}):Object(k.jsx)(X,{children:Object(k.jsxs)(h.a,{style:Ve.listviewBox,children:[Object(k.jsx)(v.a,{style:Ve.headerText,children:"\u0421\u043f\u0438\u0441\u043e\u043a \u0444\u0430\u0439\u043b\u043e\u0432"}),s]})});return Object(k.jsx)(ce.a,{style:Ve.mainScroll,contentContainerStyle:{flexDirection:"row",justifyContent:"center"},children:Object(k.jsxs)(h.a,{style:Ve.container,children:[t,n,o,r]})})}}]),n}(s.a.Component)),Ve=x.a.create({mainScroll:{backgroundColor:R.colors.background},input:{margin:8,padding:6,borderWidth:1,borderRadius:3,borderColor:R.colors.accent,color:R.colors.text},container:{paddingBottom:16,maxWidth:700,flex:1},inputBox:{flexDirection:"column",alignItems:"center"},headerText:{fontSize:24,color:R.colors.text,textAlign:"center",fontWeight:"bold",marginBottom:12},disclaimer:{fontSize:11,textAlign:"center",marginBottom:10,color:R.colors.text2},selectFileBox:{alignItems:"center",flexDirection:"row"},listviewBox:{flexDirection:"column"},listview:{backgroundColor:R.colors.background,borderRadius:4,alignItems:"center",flexDirection:"row",margin:4,flex:1},listItemHeader:Object(b.a)({color:R.colors.text2,margin:10},J.a.select({android:{fontSize:12},default:{fontSize:15}})),listItemButton:Object(b.a)({},J.a.select({android:{marginLeft:6},default:{marginLeft:8}})),convertFileBox:{alignSelf:"center",flexDirection:"row",marginTop:10},downloadFileBox:{justifyContent:"center",alignSelf:"center",marginTop:10}}),Qe=Ke,Ze=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this,e)).getToken=Object(l.a)(i.a.mark((function e(){var t,n,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=JSON,e.next=4,F.a.getItem("userProfile");case 4:e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1),n=t.access_token,s=t.refresh_token,o=t.is_student,r._isMounted&&r.setState({accessToken:n,refreshToken:s,isStudent:o}),console.log("saved info:"),console.log("accessToken:",n),console.log("refreshToken:",s),console.log("isStudent:",o),e.next=18;break;case 16:e.prev=16,e.t2=e.catch(0);case 18:r._isMounted&&r.setState({isLoading:!1});case 19:case"end":return e.stop()}}),e,null,[[0,16]])}))),r.tryRefreshToken=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,s,o,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("tryRefreshToken!",t),(n={access_token_cookie:r.state.accessToken,refresh_token_cookie:r.state.refreshToken}).refresh_token_cookie){e.next=5;break}return console.log("null refresh_token_cookie when refresh"),e.abrupt("return");case 5:return e.next=7,fetch(U+"/refresh_token",{mode:"cors",method:"PUT",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}});case 7:if(200!=(s=e.sent).status){e.next=18;break}return e.next=11,s.json();case 11:return o=e.sent,e.next=14,F.a.setItem("userProfile",JSON.stringify({access_token:o.access_token,refresh_token:o.refresh_token,is_student:r.state.isStudent}));case 14:r.appFunctions.redirect({accessToken:o.access_token,refreshToken:o.refresh_token,isStudent:r.state.isStudent}),setTimeout((function(){t()}),250),e.next=33;break;case 18:if(400!=s.status){e.next=29;break}return e.prev=19,e.next=22,F.a.removeItem("userProfile");case 22:r.appFunctions.redirect({accessToken:null,refreshToken:null,isStudent:null}),e.next=27;break;case 25:e.prev=25,e.t0=e.catch(19);case 27:e.next=33;break;case 29:return e.next=31,s.json();case 31:a=e.sent,console.log(a.message);case 33:case"end":return e.stop()}}),e,null,[[19,25]])})));return function(t){return e.apply(this,arguments)}}(),r.setToken=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.accessToken,s=t.refreshToken,o=t.isStudent,r._isMounted&&r.setState({accessToken:n,refreshToken:s,isStudent:o});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.appFunctions={redirect:r.setToken,tryRefreshToken:r.tryRefreshToken},r.state={isLoading:!0,isStudent:!0,accessToken:null,refreshToken:null},r._isMounted=!1,r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.getToken(),window.addEventListener("resize",this.resize.bind(this)),this.resize()}},{key:"resize",value:function(){this._isMounted&&this.setState({innerWidth:window.innerWidth})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize.bind(this)),this._isMounted=!1}},{key:"checkToken",value:function(e,t){return!(e&&t)}},{key:"render",value:function(){var e=this.state,t=e.isLoading,n=e.isStudent,r=e.accessToken,s=e.refreshToken;if(t)return Object(k.jsx)(V,{style:{height:"100vh",width:"100vw"}});var o=n?{Home:{component:Ce,path:"/app",exact:!0},Schedule:{component:Se,path:"/app/schedule"},Converter:{component:pe,path:"/app/converter"},ChatRooms:{component:He,path:"/app/rooms"},Chat:{component:se,path:"/app/chat/room_id=:room_id?&my_id=:my_id?"}}:{Home:{component:Me,path:"/app",exact:!0},Schedule:{component:Se,path:"/app/schedule"},AddTask:{component:Qe,path:"/app/add_task/date=:date?&time=:time?&group=:group?"},Converter:{component:pe,path:"/app/converter"},ChatRooms:{component:He,path:"/app/rooms"},Chat:{component:se,path:"/app/chat/room_id=:room_id?&my_id=:my_id?"}};return Object(k.jsx)(h.a,{style:{height:"100vh",width:"100vw"},children:this.checkToken(r,s)?Object(k.jsx)(z,{appFunctions:this.appFunctions}):n?Object(k.jsxs)(h.a,{style:{height:"100vh",width:"100vw"},children:[Object(k.jsx)(Fe,{}),g({routeMap:o,appFunctions:this.appFunctions})]}):Object(k.jsxs)(h.a,{style:{height:"100vh",width:"100vw"},children:[Object(k.jsx)(Le,{}),g({routeMap:o,appFunctions:this.appFunctions})]})})}}]),n}(r.Component),$e=(x.a.create({main:{flexDirection:"row",justifyContent:"space-evenly",backgroundColor:"#fff"}}),Ze),Xe=n(188),et=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function tt(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}a.a.render(Object(k.jsx)(Xe.a,{children:Object(k.jsx)($e,{})}),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/app",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/app","/service-worker.js");et?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):tt(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):tt(e)}))}}()}},[[469,1,2]]]);
//# sourceMappingURL=main.638e9a9e.chunk.js.map